---
title: "Chasing Imperfect Passes"
subtitle: "Supplementary Visualizations"
output: 
  html_document:
    self_contained: true
---

Authors: David Almona (Centre College) and Sammy Davis (Texas A&M University)


```{r echo=FALSE, warning=FALSE, message=FALSE}
library(tidyverse)
library(data.table)
library(gt)
library(ggridges)
library(nflreadr)
library(magick)
options(scipen = 0)


ball_placement_quality <- suppressMessages(fread('../data/ball_placement_quality.csv'))
```

<br>

### 1. Distribution of Placement Score
```{r echo=FALSE, warning=FALSE, message=FALSE}
ball_placement_quality |>
  ggplot(aes(x = placement_score)) +
  geom_density() +
  geom_vline(aes(xintercept = mean(placement_score, na.rm = TRUE), color = "Mean"), linetype = "solid") +
  geom_vline(aes(xintercept = median(placement_score, na.rm = TRUE), color = "Median"), linetype = "dashed") +
  scale_color_manual(
    name = "",
    values = c("Mean" = "blue", "Median" = "red")
  ) +
  labs(
    x = "Placement Score",
    y = "Density"
  ) +
  theme_bw()
```



### 2. Placement Score by Pass Result
```{r echo=FALSE, warning=FALSE, message=FALSE}
ball_placement_quality |> 
  group_by(pass_result) |> 
  summarise(
    Total = n(),
    `Average Score` = round(mean(placement_score, na.rm = TRUE), 2)
  ) |> rename("Pass Result" = "pass_result") |> 
  gt()
```

<br>

```{r echo=FALSE, warning=FALSE, message=FALSE}
ball_placement_quality |> 
  drop_na() |> 
  mutate(pass_result = factor(case_when(
    pass_result == "I" ~ "Incomplete",
    pass_result == "IN" ~ "Interception", 
    pass_result == "C" ~ "Complete",
    TRUE ~ pass_result
  ), levels = c("Interception", "Incomplete", "Complete"))) |> 
  ggplot(aes(x = placement_score, y = pass_result, fill = pass_result)) +
  geom_density_ridges(alpha = 0.6, scale = 1.5, quantile_lines = TRUE, quantiles = 2) +
  scale_y_discrete(expand = expansion(mult = c(0.1, 0))) +
  labs(
    #title = "Distribution of Placement Score by Pass Result",
    x = "Placement Score", 
    y = "Pass Result",
    caption = "Quantile line = median"
  ) +
  theme_bw() +
  theme(legend.position = "none")
```

<br>

```{r}
# ANOVA test
anova <- aov(placement_score ~ pass_result, data = ball_placement_quality)
             
summary(anova)
```

```{r}
TukeyHSD(anova)
```

Completions have significantly better placement than incompletions and interceptions. Incompletions and interceptions are not significantly different from each other.

### 3. Placement Score by Pass Length
```{r echo=FALSE, warning=FALSE, message=FALSE}
ball_placement_quality |> 
  mutate(
    pass_bin = case_when(
      pass_length < 0 ~ 'Behind LOS',
      pass_length < 15 ~ '0-14',
      pass_length < 25 ~ '15-24',
      pass_length <= 39 ~ '25-39',
      TRUE ~ '40+'
    )
  ) |> 
  drop_na() |> 
  mutate(pass_bin = factor(pass_bin, levels = c("40+", "25-39", "15-24", '0-14', 'Behind LOS'))) |> 
  ggplot(aes(x = placement_score, y = pass_bin, fill = pass_bin)) +
  geom_density_ridges(alpha = 0.6, scale = 1.5, quantile_lines = TRUE, quantiles = 2) +
  scale_y_discrete(expand = expansion(mult = c(0.1, 0))) +
  labs(
    title = "Distribution of Placement Score by Pass Length",
    x = "Placement Score", 
    y = "Pass Length (yards)",
    caption = "Quantile line = median"
  ) +
  theme_bw() +
  theme(legend.position = "none")
```

<br>

```{r}
# ANOVA test
anova <- aov(placement_score ~ pass_bin, 
             data = ball_placement_quality |> 
               mutate(
                 pass_bin = case_when(
                   pass_length < 0 ~ 'Behind LOS',
                   pass_length < 15 ~ '0-14',
                   pass_length < 25 ~ '15-24',
                   pass_length <= 39 ~ '25-39',
                   TRUE ~ '40+'
                   )
                 )
               )
             
summary(anova)
```

There is statistical evidence that ball placement score differs depending on pass length.

### 4. Placement Score by Route of Targeted Receiver
```{r echo=FALSE, warning=FALSE, message=FALSE}
ball_placement_quality |>
  group_by(route_of_targeted_receiver) |> 
  drop_na() |> 
  summarise(
    Total = n(),
    `Placement Score` = round(mean(placement_score, na.rm = TRUE), 2)
  ) |> arrange(desc(`Placement Score`)) |> 
  rename("Receiver's Route" = "route_of_targeted_receiver") |> 
  gt()
```

### 5. Placement Score by Coverage Type
```{r echo=FALSE, warning=FALSE, message=FALSE}
ball_placement_quality |>
  group_by(team_coverage_man_zone) |> 
  drop_na() |> 
  summarise(
    Total = n(),
    `Placement Score` = round(mean(placement_score, na.rm = TRUE), 2)
  ) |> arrange(desc(`Placement Score`)) |> 
  rename("Coverage Type" = "team_coverage_man_zone") |> 
  gt()
```

<br>

```{r}
# ANOVA test
anova <- aov(placement_score ~ team_coverage_man_zone, data = ball_placement_quality)
summary(anova)
```
There is statistical evidence that ball placement score differs depending on whether the defense is in man or zone coverage.

### 6. Placement Score by Player Position
```{r echo=FALSE, warning=FALSE, message=FALSE}
ball_placement_quality |>
  filter(player_position %in% c("TE", "RB", "WR")) |> 
  mutate(player_position = factor(player_position, levels = c("WR", "TE", "RB"))) |> 
  ggplot(aes(x = placement_score, y = player_position, fill = player_position)) +
  geom_density_ridges(alpha = 0.6, scale = 1.5, quantile_lines = TRUE, quantiles = 2) +
  scale_y_discrete(expand = expansion(mult = c(0.1, 0))) +
  labs(
    x = "Placement Score", 
    y = "Player Position",
    caption = "Quantile line = median"
  ) +
  theme_bw() +
  theme(legend.position = "none")
```

<br>

```{r}
# ANOVA test
anova <- aov(placement_score ~ player_position, data = ball_placement_quality |> filter(player_position %in% c("TE", "RB", "WR")))
             
summary(anova)
```

```{r}
TukeyHSD(anova)
```

